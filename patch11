diff --git a/tests/src/Functional/JuiceboxCaseTestBase.php b/tests/src/Functional/JuiceboxCaseTestBase.php
index 03802bd..323db9e 100644
--- a/tests/src/Functional/JuiceboxCaseTestBase.php
+++ b/tests/src/Functional/JuiceboxCaseTestBase.php
@@ -72,7 +72,7 @@ abstract class JuiceboxCaseTestBase extends BrowserTestBase {
       'settings' => $field_storage_settings,
       'cardinality' => FieldStorageDefinitionInterface::CARDINALITY_UNLIMITED,
     ];
-    entity_create('field_storage_config', $field_storage)->save();
+    \Drupal::entityTypeManager()->getStorage('field_storage_config')->create($field_storage)->save();
     // Prep a field instance.
     $field_settings = [];
     if ($this->instFieldType == 'image') {
@@ -93,16 +93,15 @@ abstract class JuiceboxCaseTestBase extends BrowserTestBase {
       'required' => FALSE,
       'settings' => $field_settings,
     ];
-    entity_create('field_config', $field)->save();
+    \Drupal::entityTypeManager()->getStorage('field_config')->create($field)->save();
     // Setup widget.
-    entity_get_form_display('node', $this->instBundle, 'default')
+    \Drupal::service('entity_display.repository')->getFormDisplay('node', $this->instBundle)
       ->setComponent($this->instFieldName, [
         'type' => 'file_generic',
         'settings' => [],
-      ])
-      ->save();
+      ])->save();
     // Clear some caches for good measure.
-    $entity_manager = $this->container->get('entity.manager');
+    $entity_manager = $this->container->get('entity_type.manager');
     $entity_manager->getStorage('field_storage_config')->resetCache();
     $entity_manager->getStorage('field_config')->resetCache();
   }
@@ -111,12 +110,11 @@ abstract class JuiceboxCaseTestBase extends BrowserTestBase {
    * Helper to activate a Juicebox field formatter on a field.
    */
   protected function activateJuiceboxFieldFormatter() {
-    entity_get_display('node', $this->instBundle, 'default')
+    \Drupal::service('entity_display.repository')->getFormDisplay('node', $this->instBundle)
       ->setComponent($this->instFieldName, [
         'type' => 'juicebox_formatter',
         'settings' => [],
-      ])
-      ->save();
+      ]);
   }
 
   /**
@@ -154,7 +152,7 @@ abstract class JuiceboxCaseTestBase extends BrowserTestBase {
       $this->submitForm($edit, 'Save');
       // Clear some caches for good measure and save the node object for
       // reference during tests.
-      $node_storage = $this->container->get('entity.manager')->getStorage('node');
+      $node_storage = $this->container->get('entity_type.manager')->getStorage('node');
       $node_storage->resetCache([$nid]);
       $this->node = $node_storage->load($nid);
       return TRUE;
diff --git a/tests/src/Functional/JuiceboxConfCase.php b/tests/src/Functional/JuiceboxConfCase.php
index 037a81e..a254b8d 100644
--- a/tests/src/Functional/JuiceboxConfCase.php
+++ b/tests/src/Functional/JuiceboxConfCase.php
@@ -17,12 +17,12 @@ class JuiceboxConfCase extends JuiceboxCaseTestBase {
    *
    * @var array
    */
-  public static $modules = ['node', 'field_ui', 'image', 'juicebox'];
+  protected static $modules = ['node', 'field_ui', 'image', 'juicebox'];
 
   /**
    * Define setup tasks.
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
     // Create and login user.
     $this->webUser = $this->drupalCreateUser([
@@ -55,13 +55,13 @@ class JuiceboxConfCase extends JuiceboxCaseTestBase {
     // also prime the cache in order to test cache tag invalidation once the
     // settings are altered.
     $this->drupalGet('node/' . $node->id());
-    $this->assertRaw(trim(json_encode([
+    $this->assertSession()->responseContains(trim(json_encode([
       'gallerywidth' => '100%',
       'galleryheight' => '100%',
       'backgroundcolor' => '#222222',
     ]), '{}'), 'Expected default configuration options found in Drupal.settings.');
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertRaw('<juicebox gallerywidth="100%" galleryheight="100%" backgroundcolor="#222222" textcolor="rgba(255,255,255,1)" thumbframecolor="rgba(255,255,255,.5)" showopenbutton="TRUE" showexpandbutton="TRUE" showthumbsbutton="TRUE" usethumbdots="FALSE" usefullscreenexpand="FALSE">', 'Expected default configuration options set in XML.');
+    $this->assertSession()->responseContains('<juicebox gallerywidth="100%" galleryheight="100%" backgroundcolor="#222222" textcolor="rgba(255,255,255,1)" thumbframecolor="rgba(255,255,255,.5)" showopenbutton="TRUE" showexpandbutton="TRUE" showthumbsbutton="TRUE" usethumbdots="FALSE" usefullscreenexpand="FALSE">', 'Expected default configuration options set in XML.');
     // Alter settings to contain custom values.
     $this->drupalLogin($this->webUser);
     $this->drupalGet('admin/structure/types/manage/' . $this->instBundle . '/display');
@@ -79,19 +79,19 @@ class JuiceboxConfCase extends JuiceboxCaseTestBase {
       'fields[' . $this->instFieldName . '][settings_edit_form][settings][jlib_useFullscreenExpand]' => TRUE,
     ];
     $this->submitForm($edit, 'Save');
-    $this->assertText($this->t('Your settings have been saved.'), 'Gallery configuration changes saved.');
+    $this->assertSession()->pageTextContains('Your settings have been saved.');
     // Now check the resulting XML again as an anon user.
     $this->drupalLogout();
     // Check for correct embed markup.
     $this->drupalGet('node/' . $node->id());
-    $this->assertRaw(trim(json_encode([
+    $this->assertSession()->responseContains(trim(json_encode([
       'gallerywidth' => '50%',
       'galleryheight' => '200px',
       'backgroundcolor' => 'red',
     ]), '{}'), 'Expected custom Lite configuration options found in Drupal.settings.');
     // Check for correct XML.
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertRaw('<juicebox gallerywidth="50%" galleryheight="200px" backgroundcolor="red" textcolor="green" thumbframecolor="blue" showopenbutton="FALSE" showexpandbutton="FALSE" showthumbsbutton="FALSE" usethumbdots="TRUE" usefullscreenexpand="TRUE">', 'Expected custom Lite configuration options set in XML.');
+    $this->assertSession()->responseContains('<juicebox gallerywidth="50%" galleryheight="200px" backgroundcolor="red" textcolor="green" thumbframecolor="blue" showopenbutton="FALSE" showexpandbutton="FALSE" showthumbsbutton="FALSE" usethumbdots="TRUE" usefullscreenexpand="TRUE">', 'Expected custom Lite configuration options set in XML.');
   }
 
   /**
@@ -102,9 +102,9 @@ class JuiceboxConfCase extends JuiceboxCaseTestBase {
     // Do a set of control requests as an anon user that will also prime any
     // caches.
     $this->drupalGet('node/' . $node->id());
-    $this->assertResponse(200, 'Control request of test node was successful.');
+    $this->assertSession()->statusCodeEquals(200);
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertResponse(200, 'Control request of XML was successful.');
+    $this->assertSession()->statusCodeEquals(200);
     // Set new manual options and also add a manual customization that's
     // intended to override a custom Lite option.
     $this->drupalLogin($this->webUser);
@@ -115,18 +115,18 @@ class JuiceboxConfCase extends JuiceboxCaseTestBase {
       'fields[' . $this->instFieldName . '][settings_edit_form][settings][manual_config]' => "sHoWoPeNbUtToN=\"FALSE\"\nshowexpandbutton=\"TRUE\"\ngallerywidth=\"50%\"\nmyCustomSetting=\"boomsauce\"",
     ];
     $this->submitForm($edit, 'Save');
-    $this->assertText($this->t('Your settings have been saved.'), 'Gallery configuration changes saved.');
+    $this->assertSession()->pageTextContains('Your settings have been saved.');
     $this->drupalLogout();
     // Check for correct embed markup.
     $this->drupalGet('node/' . $node->id());
-    $this->assertRaw(trim(json_encode([
+    $this->assertSession()->responseContains(trim(json_encode([
       'gallerywidth' => '50%',
       'galleryheight' => '100%',
       'backgroundcolor' => '#222222',
     ]), '{}'), 'Expected custom configuration options found in Drupal.settings.');
     // Check for correct XML.
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertRaw('<juicebox gallerywidth="50%" galleryheight="100%" backgroundcolor="#222222" textcolor="rgba(255,255,255,1)" thumbframecolor="rgba(255,255,255,.5)" showopenbutton="FALSE" showexpandbutton="TRUE" showthumbsbutton="TRUE" usethumbdots="FALSE" usefullscreenexpand="FALSE" mycustomsetting="boomsauce">', 'Expected custom Pro configuration options set in XML.');
+    $this->assertSession()->responseContains('<juicebox gallerywidth="50%" galleryheight="100%" backgroundcolor="#222222" textcolor="rgba(255,255,255,1)" thumbframecolor="rgba(255,255,255,.5)" showopenbutton="FALSE" showexpandbutton="TRUE" showthumbsbutton="TRUE" usethumbdots="FALSE" usefullscreenexpand="FALSE" mycustomsetting="boomsauce">', 'Expected custom Pro configuration options set in XML.');
   }
 
   /**
@@ -137,11 +137,11 @@ class JuiceboxConfCase extends JuiceboxCaseTestBase {
     // Get the urls to the main image with and without "large" styling.
     $uri = File::load($node->{$this->instFieldName}[0]->target_id)->getFileUri();
     $test_image_url = file_create_url($uri);
-    $test_image_url_formatted = entity_load('image_style', 'juicebox_medium')->buildUrl($uri);
+    $test_image_url_formatted = \Drupal::entityTypeManager()->getStorage('image_style')->load('juicebox_medium')->buildUrl($uri);
     // Check control case without custom configuration.
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertRaw('linkTarget="_blank"', 'Default linkTarget setting found.');
-    $this->assertRaw('linkURL="' . $test_image_url, 'Test unstyled image found in XML');
+    $this->assertSession()->responseContains('linkTarget="_blank"', 'Default linkTarget setting found.');
+    $this->assertSession()->responseContains('linkURL="' . $test_image_url, 'Test unstyled image found in XML');
     // Set new advanced options.
     $this->drupalLogin($this->webUser);
     $this->drupalGet('admin/structure/types/manage/' . $this->instBundle . '/display');
@@ -153,15 +153,15 @@ class JuiceboxConfCase extends JuiceboxCaseTestBase {
       'fields[' . $this->instFieldName . '][settings_edit_form][settings][custom_parent_classes]' => 'my-custom-wrapper',
     ];
     $this->submitForm($edit, 'Save');
-    $this->assertText($this->t('Your settings have been saved.'), 'Gallery configuration changes saved.');
+    $this->assertSession()->pageTextContains('Your settings have been saved.');
     $this->drupalLogout();
     // Check case with custom configuration.
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertRaw('linkTarget="_self"', 'Updated linkTarget setting found in XML.');
-    $this->assertRaw('linkURL="' . Html::escape($test_image_url_formatted), 'Test styled image found in XML for linkURL.');
+    $this->assertSession()->responseContains('linkTarget="_self"', 'Updated linkTarget setting found in XML.');
+    $this->assertSession()->responseContains('linkURL="' . Html::escape($test_image_url_formatted), 'Test styled image found in XML for linkURL.');
     // Also check for custom class in embed code.
     $this->drupalGet('node/' . $node->id());
-    $this->assertRaw('class="juicebox-parent my-custom-wrapper"', 'Custom class found in embed code.');
+    $this->assertSession()->responseContains('class="juicebox-parent my-custom-wrapper"', 'Custom class found in embed code.');
   }
 
 }
diff --git a/tests/src/Functional/JuiceboxConfGlobalCase.php b/tests/src/Functional/JuiceboxConfGlobalCase.php
index 59013c4..0aba1d6 100644
--- a/tests/src/Functional/JuiceboxConfGlobalCase.php
+++ b/tests/src/Functional/JuiceboxConfGlobalCase.php
@@ -18,12 +18,12 @@ class JuiceboxConfGlobalCase extends JuiceboxCaseTestBase {
    *
    * @var array
    */
-  public static $modules = ['node', 'field_ui', 'image', 'juicebox'];
+  protected static $modules = ['node', 'field_ui', 'image', 'juicebox'];
 
   /**
    * Define setup tasks.
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
     // Create and login user.
     // @todo Reactivate translation perms when issue #2573975 is resolved.
@@ -61,7 +61,7 @@ class JuiceboxConfGlobalCase extends JuiceboxCaseTestBase {
     // Do a control request of the XML as an anon user that will also prime any
     // caches.
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertResponse(200, 'Control request of XML was successful.');
+    $this->assertSession()->statusCodeEquals(200);
     // Enable optional global settings.
     $this->drupalLogin($this->webUser);
     $edit = [
@@ -69,13 +69,13 @@ class JuiceboxConfGlobalCase extends JuiceboxCaseTestBase {
     ];
     $this->drupalGet('admin/config/media/juicebox');
     $this->submitForm($edit, 'Save configuration');
-    $this->assertText($this->t('The Juicebox configuration options have been saved'), 'Custom global options saved.');
+    $this->assertSession()->pageTextContains('The Juicebox configuration options have been saved');
     // Now check the resulting XML again as an anon user.
     $this->drupalLogout();
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
     // Check the the XML now returns an 'Access-Control-Allow-Origin' header
     // for CORS support.
-    $this->assertEqual($this->drupalGetHeader('Access-Control-Allow-Origin'), '*', 'Expected CORS header found.');
+    $this->assertEquals($this->getSession()->getResponseHeader('Access-Control-Allow-Origin'), '*', 'Expected CORS header found.');
   }
 
   /**
@@ -88,7 +88,7 @@ class JuiceboxConfGlobalCase extends JuiceboxCaseTestBase {
     // Do a control request of the XML as an anon user that will also prime any
     // caches.
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertResponse(200, 'Control request of XML was successful.');
+    $this->assertSession()->statusCodeEquals(200);
     // We want to be able to set translations.
     $this->drupalLogin($this->webUser);
     $edit = [
@@ -103,7 +103,7 @@ class JuiceboxConfGlobalCase extends JuiceboxCaseTestBase {
     ];
     $this->drupalGet('admin/config/media/juicebox');
     $this->submitForm($edit, 'Save configuration');
-    $this->assertText($this->t('The Juicebox configuration options have been saved'), 'Custom global options saved.');
+    $this->assertSession()->pageTextContains('The Juicebox configuration options have been saved');
     // We need to set a translation for our languagelist string. There is
     // probably a good way to do this directly in code, but for now it's fairly
     // easy to just brute-force it via the UI. First we need to visit the
@@ -123,13 +123,13 @@ class JuiceboxConfGlobalCase extends JuiceboxCaseTestBase {
       'strings[' . $matches[1] . '][translations][0]' => 'Translated|Lang|List',
     ];
     $this->submitForm($edit, 'Save translations');
-    $this->assertText($this->t('The strings have been saved'), 'Languagelist translation saved.');
+    $this->assertSession()->pageTextContains('The strings have been saved');
     // Now check the resulting XML again as an anon user.
     $this->drupalLogout();
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
     // Check that the languagelist configuration option was both included and
     // translated in the XML.
-    $this->assertRaw('languagelist="Translated|Lang|List"', 'Translated languagelist value found in XML.');
+    $this->assertSession()->responseContains('languagelist="Translated|Lang|List"');
   }
 
   /**
@@ -140,7 +140,7 @@ class JuiceboxConfGlobalCase extends JuiceboxCaseTestBase {
     // Do a control request of the XML as an anon user that will also prime any
     // caches.
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertResponse(200, 'Control request of XML was successful.');
+    $this->assertSession()->statusCodeEquals(200);
     // Customize one of our global multi-size settings from the default for a
     // true end-to-end test.
     $this->drupalLogin($this->webUser);
@@ -149,7 +149,7 @@ class JuiceboxConfGlobalCase extends JuiceboxCaseTestBase {
     ];
     $this->drupalGet('admin/config/media/juicebox');
     $this->submitForm($edit, 'Save configuration');
-    $this->assertText($this->t('The Juicebox configuration options have been saved'), 'Custom global options saved.');
+    $this->assertSession()->pageTextContains('The Juicebox configuration options have been saved');
     // Alter field formatter specific settings to use multi-size style.
     $this->drupalGet('admin/structure/types/manage/' . $this->instBundle . '/display');
     $this->submitForm([], $this->instFieldName . '_settings_edit', 'entity-view-display-edit-form');
@@ -157,19 +157,19 @@ class JuiceboxConfGlobalCase extends JuiceboxCaseTestBase {
       'fields[' . $this->instFieldName . '][settings_edit_form][settings][image_style]' => 'juicebox_multisize',
     ];
     $this->submitForm($edit, 'Save');
-    $this->assertText($this->t('Your settings have been saved.'), 'Gallery configuration changes saved.');
+    $this->assertSession()->pageTextContains('Your settings have been saved.');
     // Calculate the multi-size styles that should be found in the XML.
     $uri = File::load($node->{$this->instFieldName}[0]->target_id)->getFileUri();
-    $formatted_image_small = entity_load('image_style', 'juicebox_small')->buildUrl($uri);
-    $formatted_image_medium = entity_load('image_style', 'juicebox_medium')->buildUrl($uri);
-    $formatted_image_large = entity_load('image_style', 'large')->buildUrl($uri);
+    $formatted_image_small = \Drupal::entityTypeManager()->getStorage('image_style')->load('juicebox_small')->buildUrl($uri);
+    $formatted_image_medium = \Drupal::entityTypeManager()->getStorage('image_style')->load('juicebox_medium')->buildUrl($uri);
+    $formatted_image_large = \Drupal::entityTypeManager()->getStorage('image_style')->load('large')->buildUrl($uri);
     // Now check the resulting XML again as an anon user.
     $this->drupalLogout();
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
     // Check that the expected images are found in the XML.
-    $this->assertRaw('smallImageURL="' . Html::escape($formatted_image_small), 'Test small image found in XML.');
-    $this->assertRaw('imageURL="' . Html::escape($formatted_image_medium), 'Test medium image found in XML.');
-    $this->assertRaw('largeImageURL="' . Html::escape($formatted_image_large), 'Test large image found in XML.');
+    $this->assertSession()->responseContains('smallImageURL="' . Html::escape($formatted_image_small));
+    $this->assertSession()->responseContains('imageURL="' . Html::escape($formatted_image_medium));
+    $this->assertSession()->responseContains('largeImageURL="' . Html::escape($formatted_image_large));
   }
 
 }
diff --git a/tests/src/Functional/JuiceboxFieldFormatterCase.php b/tests/src/Functional/JuiceboxFieldFormatterCase.php
index e29e415..d5f7949 100644
--- a/tests/src/Functional/JuiceboxFieldFormatterCase.php
+++ b/tests/src/Functional/JuiceboxFieldFormatterCase.php
@@ -20,7 +20,7 @@ class JuiceboxFieldFormatterCase extends JuiceboxCaseTestBase {
    *
    * @var array
    */
-  public static $modules = [
+  protected static $modules = [
     'node',
     'field_ui',
     'image',
@@ -32,7 +32,7 @@ class JuiceboxFieldFormatterCase extends JuiceboxCaseTestBase {
   /**
    * Define setup tasks.
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
     // Create and login user.
     $this->webUser = $this->drupalCreateUser([
@@ -66,9 +66,9 @@ class JuiceboxFieldFormatterCase extends JuiceboxCaseTestBase {
     // Do a set of control requests as an anon user that will also prime any
     // caches.
     $this->drupalGet('node/' . $node->id());
-    $this->assertResponse(200, 'Control request of test node was successful.');
+    $this->assertSession()->statusCodeEquals(200);
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertResponse(200, 'Control request of XML was successful.');
+    $this->assertSession()->statusCodeEquals(200);
     // Alter field formatter specific settings to contain custom values.
     $this->drupalLogin($this->webUser);
     $this->drupalGet('admin/structure/types/manage/' . $this->instBundle . '/display');
@@ -80,24 +80,24 @@ class JuiceboxFieldFormatterCase extends JuiceboxCaseTestBase {
       'fields[' . $this->instFieldName . '][settings_edit_form][settings][title_source]' => 'title',
     ];
     $this->submitForm($edit, 'Save');
-    $this->assertText($this->t('Your settings have been saved.'), 'Gallery configuration changes saved.');
+    $this->assertSession()->pageTextContains('Your settings have been saved. Gallery configuration changes saved.');
     // Get the urls to the image and thumb derivatives expected.
     $uri = File::load($node->{$this->instFieldName}[0]->target_id)->getFileUri();
     $test_formatted_image_url = file_create_url($uri);
-    $test_formatted_thumb_url = entity_load('image_style', 'thumbnail')->buildUrl($uri);
+    $test_formatted_thumb_url = \Drupal::entityTypeManager()->getStorage('image_style')->load('thumbnail')->buildUrl($uri);
     // Check for correct embed markup as anon user.
     $this->drupalLogout();
     $this->drupalGet('node/' . $node->id());
-    $this->assertRaw(Html::escape(file_url_transform_relative($test_formatted_image_url)), 'Test styled image found in embed code');
+    $this->assertSession()->responseContains(Html::escape(file_url_transform_relative($test_formatted_image_url)));
     // Check for correct XML.
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertRaw('imageURL="' . Html::escape($test_formatted_image_url), 'Test styled image found in XML.');
-    $this->assertRaw('thumbURL="' . Html::escape($test_formatted_thumb_url), 'Test styled thumbnail found in XML.');
+    $this->assertSession()->responseContains('imageURL="' . Html::escape($test_formatted_image_url));
+    $this->assertSession()->responseContains('thumbURL="' . Html::escape($test_formatted_thumb_url));
     // Note the intended title and caption text does not contain any block-level
     // tags as long as the global title and caption output filter is working.
     // So this acts as a test for that feature as well.
-    $this->assertRaw('<title><![CDATA[Some title text for field ' . $this->instFieldName . ' on node ' . $node->id() . ']]></title>', 'Image title text found in XML');
-    $this->assertRaw('<caption><![CDATA[Some alt text for field ' . $this->instFieldName . ' on node ' . $node->id() . ' &lt;strong&gt;with formatting&lt;/strong&gt;]]></caption>', 'Image caption text found in XML');
+    $this->assertSession()->responseContains('<title><![CDATA[Some title text for field ' . $this->instFieldName . ' on node ' . $node->id() . ']]></title>');
+    $this->assertSession()->responseContains('<caption><![CDATA[Some alt text for field ' . $this->instFieldName . ' on node ' . $node->id() . ' &lt;strong&gt;with formatting&lt;/strong&gt;]]></caption>');
     // Now that we have title and caption data set, also ensure this text can
     // be found in search results. First we update the search index by marking
     // our test node as dirty and running cron.
@@ -107,10 +107,10 @@ class JuiceboxFieldFormatterCase extends JuiceboxCaseTestBase {
     $this->cronRun();
     $this->drupalGet('search');
     $this->submitForm(['keys' => '"Some title text"'], 'Search');
-    $this->assertText('Test Juicebox Gallery Node', 'Juicebox node found in search for title text.');
+    $this->assertSession()->pageTextContains('Test Juicebox Gallery Node');
     // The Juicebox javascript should have been excluded from the search results
     // page.
-    $this->assertNoRaw('"configUrl":"', 'Juicebox Drupal.settings vars not included on search result page.');
+    $this->assertSession()->responseNotContains('"configUrl":"');
   }
 
   /**
@@ -120,9 +120,9 @@ class JuiceboxFieldFormatterCase extends JuiceboxCaseTestBase {
     $node = $this->node;
     // The node and XML should be initially accessible (control test).
     $this->drupalGet('node/' . $node->id());
-    $this->assertResponse(200, 'Access allowed for published node.');
+    $this->assertSession()->statusCodeEquals(200);
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertRaw('<?xml version="1.0" encoding="UTF-8"', 'XML access allowed to published node (valid XML detected).');
+    $this->assertSession()->responseContains('<?xml version="1.0" encoding="UTF-8"');
     // Now unpublish the node as a way of making it inaccessible to
     // non-privileged users. There are unlimited ways that access can be
     // restricted, such as other perm settings, contrb module controls for
@@ -133,9 +133,9 @@ class JuiceboxFieldFormatterCase extends JuiceboxCaseTestBase {
     $node->save();
     // Re-check access.
     $this->drupalGet('node/' . $node->id());
-    $this->assertResponse(403, 'Access blocked for unpublished node.');
+    $this->assertSession()->statusCodeEquals(403);
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertResponse(403, 'XML access blocked for unpublished node.');
+    $this->assertSession()->statusCodeEquals(403);
   }
 
 }
diff --git a/tests/src/Functional/JuiceboxFileCase.php b/tests/src/Functional/JuiceboxFileCase.php
index b893fba..ef9bcc0 100644
--- a/tests/src/Functional/JuiceboxFileCase.php
+++ b/tests/src/Functional/JuiceboxFileCase.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\juicebox\Functional;
 
+use Drupal\Core\Url;
 use Drupal\file\Entity\File;
 use Drupal\Component\Utility\Html;
 
@@ -17,7 +18,7 @@ class JuiceboxFileCase extends JuiceboxCaseTestBase {
    *
    * @var array
    */
-  public static $modules = ['node', 'field_ui', 'image', 'juicebox'];
+  protected static $modules = ['node', 'field_ui', 'image', 'juicebox'];
 
   /**
    * The field name.
@@ -36,7 +37,7 @@ class JuiceboxFileCase extends JuiceboxCaseTestBase {
   /**
    * Define setup tasks.
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
     // Create and login user.
     $this->webUser = $this->drupalCreateUser([
@@ -64,28 +65,30 @@ class JuiceboxFileCase extends JuiceboxCaseTestBase {
     $this->createNodeWithFile();
     $node = $this->node;
     $xml_path = 'juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full';
-    $xml_url = \Drupal::url('juicebox.xml_field', [
+    $xml_url = Url::fromRoute('juicebox.xml_field', [
       'entityType' => 'node',
       'entityId' => $node->id(),
       'fieldName' => $this->instFieldName,
       'displayName' => 'full',
-    ]);
+    ])->toString();
     // Get the urls to the test image and thumb derivative used by default.
     $uri = File::load($node->{$this->instFieldName}[0]->target_id)->getFileUri();
-    $test_image_url = entity_load('image_style', 'juicebox_medium')->buildUrl($uri);
-    $test_thumb_url = entity_load('image_style', 'juicebox_square_thumb')->buildUrl($uri);
+    $test_image_url = \Drupal::entityTypeManager()
+      ->getStorage('image_style')->load('juicebox_medium')->buildUrl($uri);
+    $test_thumb_url = \Drupal::entityTypeManager()
+      ->getStorage('image_style')->load('juicebox_square_thumb')->buildUrl($uri);
     // Check for correct embed markup as anon user.
     $this->drupalLogout();
     $this->drupalGet('node/' . $node->id());
-    $this->assertRaw(trim(json_encode(['configUrl' => $xml_url]), '{}"'), 'Gallery setting found in Drupal.settings.');
-    $this->assertRaw('id="node--' . $node->id() . '--' . str_replace('_', '-', $this->instFieldName) . '--full"', 'Embed code wrapper found.');
-    $this->assertRaw(Html::escape(file_url_transform_relative($test_image_url)), 'Test image found in embed code');
+    $this->assertSession()->pageTextContains(trim(json_encode(['configUrl' => $xml_url]), '{}"'));
+    $this->assertSession()->pageTextContains('id="node--' . $node->id() . '--' . str_replace('_', '-', $this->instFieldName) . '--full"');
+    $this->assertSession()->pageTextContains(Html::escape(file_url_transform_relative($test_image_url)));
     // Check for correct XML.
     $this->drupalGet($xml_path);
-    $this->assertRaw('<?xml version="1.0" encoding="UTF-8"?>', 'Valid XML detected.');
-    $this->assertRaw('imageURL="' . Html::escape($test_image_url), 'Test image found in XML.');
-    $this->assertRaw('thumbURL="' . Html::escape($test_thumb_url), 'Test thumbnail found in XML.');
-    $this->assertRaw('<juicebox gallerywidth="100%" galleryheight="100%" backgroundcolor="#222222" textcolor="rgba(255,255,255,1)" thumbframecolor="rgba(255,255,255,.5)" showopenbutton="TRUE" showexpandbutton="TRUE" showthumbsbutton="TRUE" usethumbdots="FALSE" usefullscreenexpand="FALSE">', 'Expected default configuration options set in XML.');
+    $this->assertSession()->responseContains('<?xml version="1.0" encoding="UTF-8"?>', 'Valid XML detected.');
+    $this->assertSession()->responseContains('imageURL="' . Html::escape($test_image_url), 'Test image found in XML.');
+    $this->assertSession()->responseContains('thumbURL="' . Html::escape($test_thumb_url), 'Test thumbnail found in XML.');
+    $this->assertSession()->responseContains('<juicebox gallerywidth="100%" galleryheight="100%" backgroundcolor="#222222" textcolor="rgba(255,255,255,1)" thumbframecolor="rgba(255,255,255,.5)" showopenbutton="TRUE" showexpandbutton="TRUE" showthumbsbutton="TRUE" usethumbdots="FALSE" usefullscreenexpand="FALSE">', 'Expected default configuration options set in XML.');
   }
 
   /**
@@ -100,7 +103,7 @@ class JuiceboxFileCase extends JuiceboxCaseTestBase {
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
     // With the default settings we expect an "application-octet-stream.png"
     // value for both the image and the thumbnail.
-    $this->assertPattern('|imageURL=.*text.png.*thumbURL=.*text.png|', 'Non-image mimetype placeholder found for image and thumbnail.');
+    $this->assertSession()->responseMatches('|imageURL=.*text.png.*thumbURL=.*text.png|');
     // Change the file handling option to "skip".
     $this->drupalLogin($this->webUser);
     $this->drupalGet('admin/structure/types/manage/' . $this->instBundle . '/display');
@@ -109,13 +112,13 @@ class JuiceboxFileCase extends JuiceboxCaseTestBase {
       'fields[' . $this->instFieldName . '][settings_edit_form][settings][incompatible_file_action]' => 'skip',
     ];
     $this->submitForm($edit, 'Save');
-    $savemsg = $this->t('Gallery configuration changes saved.');
-    $this->assertText($savemsg);
+    $savemsg = ('Gallery configuration changes saved.');
+    $this->assertSession()->pageTextContains($savemsg);
     // Re-check the XML. This time no image should appear at all.
     $this->drupalLogout();
     $this->drupalGet('juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/full');
-    $this->assertRaw('<?xml version="1.0" encoding="UTF-8"?>', 'Valid XML detected.');
-    $this->assertNoRaw('<image', 'Non-image items was skipped.');
+    $this->assertSession()->responseContains('<?xml version="1.0" encoding="UTF-8"?>');
+    $this->assertSession()->responseNotContains('<image');
     // @todo , Check other incompatible_file_action combinations.
   }
 
diff --git a/tests/src/Functional/JuiceboxSubRequestCase.php b/tests/src/Functional/JuiceboxSubRequestCase.php
index 038aacf..e21b4a6 100644
--- a/tests/src/Functional/JuiceboxSubRequestCase.php
+++ b/tests/src/Functional/JuiceboxSubRequestCase.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\juicebox\Functional;
 
+use Drupal\Core\Url;
 use Drupal\file\Entity\File;
 use Drupal\Component\Utility\Html;
 
@@ -30,7 +31,7 @@ class JuiceboxSubRequestCase extends JuiceboxCaseTestBase {
    *
    * @var array
    */
-  public static $modules = [
+  protected static $modules = [
     'node',
     'text',
     'field',
@@ -59,10 +60,11 @@ class JuiceboxSubRequestCase extends JuiceboxCaseTestBase {
   // list above, to use the "standard" profile's article type for this test
   // instead of the one we create manually (should also work, but will be slow).
   // protected $profile = 'standard';.
+
   /**
    * Define setup tasks.
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
     // Create and login user.
     $this->webUser = $this->drupalCreateUser([
@@ -88,21 +90,23 @@ class JuiceboxSubRequestCase extends JuiceboxCaseTestBase {
   public function testSubRequestDependent() {
     $node = $this->node;
     $xml_path = 'juicebox/xml/field/node/' . $node->id() . '/' . $this->instFieldName . '/_custom';
-    $xml_url = \Drupal::url('juicebox.xml_field', [
+    $xml_url = Url::fromRoute('juicebox.xml_field', [
       'entityType' => 'node',
       'entityId' => $node->id(),
       'fieldName' => $this->instFieldName,
       'displayName' => '_custom',
-    ]);
+    ])->toString();
     // Get the urls to the test image and thumb derivative used by default.
     $uri = File::load($node->{$this->instFieldName}[0]->target_id)->getFileUri();
-    $test_image_url = entity_load('image_style', 'juicebox_medium')->buildUrl($uri);
-    $test_thumb_url = entity_load('image_style', 'juicebox_square_thumb')->buildUrl($uri);
+    $test_image_url = \Drupal::entityTypeManager()
+      ->getStorage('image_style')->load('juicebox_medium')->buildUrl($uri);
+    $test_thumb_url = \Drupal::entityTypeManager()
+      ->getStorage('image_style')->load('juicebox_square_thumb')->buildUrl($uri);
     // Check for correct embed markup. This will also prime the cache.
     $content = $this->drupalGet('juicebox_test_row_formatter');
-    $this->assertRaw(trim(json_encode(['configUrl' => $xml_url]), '{}"'), 'Gallery setting found in Drupal.settings.');
-    $this->assertRaw('id="node--' . $node->id() . '--' . str_replace('_', '-', $this->instFieldName) . '---custom"', 'Embed code wrapper found.');
-    $this->assertRaw(Html::escape($test_image_url), 'Test image found in embed code');
+    $this->assertSession()->responseContains(trim(json_encode(['configUrl' => $xml_url]), '{}"'));
+    $this->assertSession()->responseContains('id="node--' . $node->id() . '--' . str_replace('_', '-', $this->instFieldName) . '---custom"');
+    $this->assertSession()->responseContains(Html::escape($test_image_url));
     // Extract the xml-source values from the XML.
     $matches = [];
     // In the pattern below we have to use four (yeah, FOUR) backslashes to
@@ -120,10 +124,10 @@ class JuiceboxSubRequestCase extends JuiceboxCaseTestBase {
         'xml-source-id' => $matches[2],
       ],
     ]);
-    $this->assertRaw('<?xml version="1.0" encoding="UTF-8"?>', 'Valid XML detected.');
-    $this->assertRaw('imageURL="' . Html::escape($test_image_url), 'Test image found in XML.' . $test_image_url);
-    $this->assertRaw('thumbURL="' . Html::escape($test_thumb_url), 'Test thumbnail found in XML.' . $test_thumb_url);
-    $this->assertRaw('backgroundcolor="green"', 'Custom background setting from pseudo field instance config found in XML.');
+    $this->assertSession()->responseContains('<?xml version="1.0" encoding="UTF-8"?>');
+    $this->assertSession()->responseContains('imageURL="' . Html::escape($test_image_url));
+    $this->assertSession()->responseContains('thumbURL="' . Html::escape($test_thumb_url));
+    $this->assertSession()->responseContains('backgroundcolor="green"');
   }
 
 }
diff --git a/tests/src/Functional/JuiceboxViewsCase.php b/tests/src/Functional/JuiceboxViewsCase.php
index 995b6ea..1ef3d86 100644
--- a/tests/src/Functional/JuiceboxViewsCase.php
+++ b/tests/src/Functional/JuiceboxViewsCase.php
@@ -2,6 +2,7 @@
 
 namespace Drupal\Tests\juicebox\Functional;
 
+use Drupal\Core\Url;
 use Drupal\file\Entity\File;
 use Drupal\Component\Utility\Html;
 
@@ -17,7 +18,7 @@ class JuiceboxViewsCase extends JuiceboxCaseTestBase {
    *
    * @var array
    */
-  public static $modules = [
+  protected static $modules = [
     'node',
     'text',
     'field',
@@ -47,10 +48,11 @@ class JuiceboxViewsCase extends JuiceboxCaseTestBase {
   // list above, to use the "standard" profile's article type for this test
   // instead of the one we create manually (should also work, but will be slow).
   // $profile = 'standard;'.
+
   /**
    * Define setup tasks.
    */
-  public function setUp() {
+  public function setUp(): void {
     parent::setUp();
 
     // Create and login user.
@@ -84,27 +86,31 @@ class JuiceboxViewsCase extends JuiceboxCaseTestBase {
     $this->drupalLogin($this->webUser);
     $node = $this->node;
     $xml_path = 'juicebox/xml/viewsstyle/juicebox_views_test/page_2';
-    $xml_url = \Drupal::url('juicebox.xml_viewsstyle',
-     ['viewName' => 'juicebox_views_test', 'displayName' => 'page_2']);
+    $xml_url = Url::fromRoute('juicebox.xml_viewsstyle', [
+      'viewName' => 'juicebox_views_test',
+      'displayName' => 'page_2',
+    ])->toString();
     // Get the urls to the test image and thumb derivative used by default.
     $uri = File::load($node->{$this->instFieldName}[0]->target_id)->getFileUri();
-    $test_image_url = entity_load('image_style', 'juicebox_medium')->buildUrl($uri);
-    $test_thumb_url = entity_load('image_style', 'juicebox_square_thumb')->buildUrl($uri);
+    $test_image_url = \Drupal::entityTypeManager()
+      ->getStorage('image_style')->load('juicebox_medium')->buildUrl($uri);
+    $test_thumb_url = \Drupal::entityTypeManager()
+      ->getStorage('image_style')->load('juicebox_square_thumb')->buildUrl($uri);
     // Check for correct embed markup.
     $this->drupalGet('juicebox-views-test-advanced');
-    $this->assertRaw(trim(json_encode(['configUrl' => $xml_url]), '{}"'), 'Gallery setting found in Drupal.settings.');
-    $this->assertRaw('juicebox-views-test--page-2', 'Embed code wrapper found.');
-    $this->assertRaw(Html::escape(file_url_transform_relative($test_image_url)), 'Test image found in embed code');
+    $this->assertSession()->responseContains(trim(json_encode(['configUrl' => $xml_url]), '{}"'));
+    $this->assertSession()->responseContains('juicebox-views-test--page-2');
+    $this->assertSession()->responseContains(Html::escape(file_url_transform_relative($test_image_url)));
     // Check for correct XML.
     $this->drupalGet($xml_path);
-    $this->assertRaw('<?xml version="1.0" encoding="UTF-8"?>', 'Valid XML detected.');
-    $this->assertRaw('imageURL="' . Html::escape($test_image_url), 'Test image found in XML.');
-    $this->assertRaw('thumbURL="' . Html::escape($test_thumb_url), 'Test thumbnail found in XML.');
+    $this->assertSession()->responseContains('<?xml version="1.0" encoding="UTF-8"?>');
+    $this->assertSession()->responseContains('imageURL="' . Html::escape($test_image_url));
+    $this->assertSession()->responseContains('thumbURL="' . Html::escape($test_thumb_url));
     // Logout and test that XML access is restricted. Note that this test view
     // is setup to limit view access only to admins.
     $this->drupalLogout();
     $this->drupalGet('juicebox/xml/viewsstyle/juicebox_views_test/page_2');
-    $this->assertResponse(403, 'XML access blocked for access-restricted view.');
+    $this->assertSession()->statusCodeEquals(403);
   }
 
 }
